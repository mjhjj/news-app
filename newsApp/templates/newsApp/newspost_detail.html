{% extends 'newsApp/base.html' %}
{% load static %}
{% load social_share %}
{% load tz %}

{% block main %}
<link href="{% static 'newsApp/newspost_detail.css' %}?v=1.0.2" rel="stylesheet" />

<div class="content-container">
  <div class="post-container">
    <!-- Post Images Carousel -->
    <div class="post-image-wrapper">
      <div id="carouselExampleIndicators" class="carousel slide" data-mdb-ride="carousel">
        <div class="carousel-indicators">
          <button type="button" data-mdb-target="#carouselExampleIndicators" data-mdb-slide-to="0" class="active"
            aria-current="true" aria-label="Slide 1"></button>
          <button type="button" data-mdb-target="#carouselExampleIndicators" data-mdb-slide-to="1"
            aria-label="Slide 2"></button>
          <button type="button" data-mdb-target="#carouselExampleIndicators" data-mdb-slide-to="2"
            aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="https://mdbcdn.b-cdn.net/img/new/slides/041.webp" class="d-block w-100" alt="Property Image" />
          </div>
          <div class="carousel-item">
            <img src="https://mdbcdn.b-cdn.net/img/new/slides/042.webp" class="d-block w-100" alt="Property Image" />
          </div>
          <div class="carousel-item">
            <img src="https://mdbcdn.b-cdn.net/img/new/slides/043.webp" class="d-block w-100" alt="Property Image" />
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-mdb-target="#carouselExampleIndicators"
          data-mdb-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-mdb-target="#carouselExampleIndicators"
          data-mdb-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    </div>

    <!-- Post Content -->
    <div class="post-wrapper">
      <h1 class="post-title">{{ post.title }}</h1>
      <div class="post-content">{{ post.text|safe|linebreaks }}</div>
    </div>

    <!-- Stats and Share Bar -->
    <div class="post-meta-bar">
      <div class="post-stats">
        <div class="post-stat">
          <i class="far fa-eye"></i> {{ post.total_views }}
        </div>
        {% if liked %}
          <a href="{% url 'post-like' post.id %}" class="post-stat liked">
            <i class="fas fa-heart"></i> {{ post.likes }}
          </a>
        {% else %}
          <a href="{% url 'post-like' post.id %}" class="post-stat">
            <i class="far fa-heart"></i> {{ post.likes }}
          </a>
        {% endif %}
      </div>

      <div class="share-bar">
        <div class="share-title">Поділитися:</div>
        <div class="share-buttons">
          <a href="#" id="btn-fb" class="btn-fb" style="display: inline-flex; align-items: center; justify-content: center; background: #3b5998;">
            <!-- Facebook SVG -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M22.675 0h-21.35C.595 0 0 .592 0 1.326v21.348C0 23.408.595 24 1.325 24h11.495v-9.294H9.691v-3.622h3.129V8.413c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.797.143v3.24l-1.918.001c-1.504 0-1.797.715-1.797 1.763v2.313h3.587l-.467 3.622h-3.12V24h6.116C23.406 24 24 23.408 24 22.674V1.326C24 .592 23.406 0 22.675 0z"/></svg>
          </a>
          <a href="#" id="btn-tw" class="btn-tw" style="display: inline-flex; align-items: center; justify-content: center; background: #1da1f2;">
            <!-- Twitter SVG -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M24 4.557a9.83 9.83 0 0 1-2.828.775 4.932 4.932 0 0 0 2.165-2.724c-.951.564-2.005.974-3.127 1.195a4.916 4.916 0 0 0-8.38 4.482C7.691 8.095 4.066 6.13 1.64 3.161c-.542.929-.856 2.01-.857 3.17 0 2.188 1.115 4.116 2.823 5.247a4.904 4.904 0 0 1-2.229-.616c-.054 2.281 1.581 4.415 3.949 4.89a4.936 4.936 0 0 1-2.224.084c.627 1.956 2.444 3.377 4.6 3.417A9.867 9.867 0 0 1 0 21.543a13.94 13.94 0 0 0 7.548 2.209c9.058 0 14.009-7.496 14.009-13.986 0-.21 0-.423-.016-.634A9.936 9.936 0 0 0 24 4.557z"/></svg>
          </a>
          <a href="#" id="btn-tg" class="btn-tg" style="display: inline-flex; align-items: center; justify-content: center; background: #0088cc;">
            <!-- Telegram SVG -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M12 0C5.371 0 0 5.371 0 12c0 6.627 5.371 12 12 12s12-5.373 12-12c0-6.629-5.371-12-12-12zm5.707 8.293l-2.828 10.607c-.211.789-.678.979-1.371.609l-3.799-2.803-1.833-.883c-.401-.211-.412-.401.084-.612l7.184-2.822c.391-.189.779-.401.168-.612l-5.789-2.232c-.789-.303-.789-.789.168-1.039l11.377-3.289c.789-.211 1.371.189 1.139 1.039z"/></svg>
          </a>
        </div>
      </div>
    </div>

    <!-- Comments Section -->
    <div class="comments-section">
      <div class="comments-header">
        <h2 class="comments-title">Коментарі</h2>
        <span class="comment-count">{{ post.commentaries_count }}</span>
      </div>
      
      <div class="comments-body">
        <a class="btn btn-primary add-comment-btn" href="{% url 'comment-post' post.pk %}">Залишити коментар</a>
        
        {% if post.commentaries_count > 0 %}
          {% for c in commentaries %}
            <div class="comment-item">
              <div class="comment-header">
                <span class="comment-author">{{ c.reporter }}</span>
                <span class="comment-time">{{ c.time|date:'Y-m-d H:i' }}</span>
              </div>
              <div class="comment-text">{{ c.comment|safe|linebreaks }}</div>
            </div>
          {% endfor %}
        {% else %}
          <div class="no-comments">Немає коментарів. Будьте першим, хто залишить коментар!</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var postUrl = "{{ request.scheme }}://{{ request.get_host }}{% url 'post-detail' post.id %}";
    document.getElementById("btn-tw").href = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(postUrl);
    document.getElementById("btn-fb").href = "https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(postUrl);
    document.getElementById("btn-tg").href = "https://t.me/share/url?url=" + encodeURIComponent(postUrl) + "&text={{ post.title|urlencode }}";
  });
</script>
{% endblock %}